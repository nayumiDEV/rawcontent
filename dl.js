function __vite__mapDeps(e){return __vite__mapDeps.viteFileDeps||(__vite__mapDeps.viteFileDeps=[]),e.map(e=>__vite__mapDeps.viteFileDeps[e])}(e=>{if("function"==typeof GM_addStyle){GM_addStyle(e);return}let t=document.createElement("style");t.textContent=e,document.head.append(t)})(" .disabled{pointer-events:none}.animate-spin{animation:spin 1s linear infinite}.download-header{margin:0;background:0}.grey path{fill:#bdcbdb}.has-background-primary .grey path{fill:#fff}.download-icon{height:100%;padding:.75rem;border:none;background:none!important;outline:none}.progress-text{font-size:.75rem;font-weight:600}.flex{display:flex}.mb-6{margin-bottom:1.5rem}.ms-auto{margin-inline-start:auto}.space-between{justify-content:space-between}.items-center{align-items:center}.downloaded path{fill:#5cb85c}.has-background-primary .downloaded path{fill:#7be57b}.failed path{fill:#ec5b56!important}.has-background-primary .failed path{fill:#6b1717!important}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}} "),System.register("./__entry.js",[],function(e,t){return{execute:function(){let e=function e(){let t="undefined"!=typeof document&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),r={},n=function t(n,a,i){let s=Promise.resolve();if(a&&a.length>0){let o=document.getElementsByTagName("link");s=Promise.all(a.map(t=>{var n;if((t="/"+(n=t))in r)return;r[t]=!0;let a=t.endsWith(".css");if(i)for(let s=o.length-1;s>=0;s--){let l=o[s];if(l.href===t&&(!a||"stylesheet"===l.rel))return}else if(document.querySelector(`link[href="${t}"]${a?'[rel="stylesheet"]':""}`))return;let d=document.createElement("link");if(d.rel=a?"stylesheet":e,a||(d.as="script",d.crossOrigin=""),d.href=t,document.head.appendChild(d),a)return new Promise((e,r)=>{d.addEventListener("load",e),d.addEventListener("error",()=>r(Error(`Unable to preload CSS for ${t}`)))})}))}return s.then(()=>n()).catch(e=>{let t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})};"/"==location.pathname||location.pathname.startsWith("/page")||location.pathname.startsWith("/favorites")?n(()=>t.import("./library-lEMetpAe-brhYQ5Ij.js"),void 0).then(e=>e.init()):location.pathname.startsWith("/view/")?n(()=>t.import("./gallery-CPEntgS8-e9IQWd_w.js"),void 0).then(e=>e.init()):location.pathname.startsWith("/settings")&&n(()=>t.import("./settings-_03oqxPd-XE-OHLWG.js"),void 0).then(e=>e.init())}}}),System.register("./library-lEMetpAe-brhYQ5Ij.js",["./utils-YsOI_Z3f-OHnL4je-.js"],function(e,t){"use strict";var r,n,a,i,s,o,l,d;return{setters:[e=>{r=e.d,n=e.a,a=e.c,i=e.g,s=e.b,o=e.s,l=e.e,d=e.f}],execute:function(){let t=d(),c=Array.from(document.querySelectorAll(".column")),u=a(c),f=()=>{let e=document.createElement("button");return e.innerHTML="Download all",e.classList.add("button","pagination-next","download-header"),t.subscribe(t=>{switch(t.kind){case"idle":e.innerHTML="Download all",e.classList.remove("disabled");break;case"processing":e.innerHTML=`(${t.progress}/${t.total}) Downloading`,e.classList.add("disabled");break;case"success":e.innerHTML=`(${t.progress}/${t.total}) Download finished`,e.classList.add("disabled")}}),e},h=async e=>{let t=await i(e.id),r=await s(e.id);u.progress(e,0,r.length),await o(t,r,t=>u.progress(e,t,r.length))},p=async()=>{let e=c.map(e=>({id:Number(e.querySelector("a").getAttribute("href").split("/").at(-1)),title:e.querySelector(".card-header").getAttribute("title")}));"true"===localStorage.getItem("skip_download")&&(e=e.filter(e=>!r.includes(e.id)));let n=0;for(let a of e)t.processing(n,e.length),u.start(a),await h(a).then(()=>{n++,t.processing(n,e.length),u.finish(a),r.add(a.id)}).catch(e=>{u.fail(a,e)});t.success(n,e.length),await l(2500),t.idle()},$=()=>{let e=document.querySelector(".search-title"),t=f();if(t.addEventListener("click",p),e){let r=e.parentElement;r.classList.add("flex","space-between"),r.append(t)}else{t.classList.add("ms-auto");let n=document.createElement("div");n.classList.add("container","flex","mb-6"),n.append(t);let a=document.querySelector(".container"),i=a.parentElement;i.insertBefore(n,a)}},_=()=>{for(let e of c){let t=Number(e.querySelector("a").getAttribute("href").split("/").at(-1)),a=e.querySelector(".card-header").getAttribute("title"),i=document.createElement("button");i.id=`download-${t}`,i.role="download",i.title=`Download '${a}'`,i.innerHTML=n,i.classList.add("button","grey","download-icon"),r.includes(t)&&i.classList.add("downloaded"),i.addEventListener("click",e=>{e.preventDefault();let n={id:t,title:a};u.start(n),h(n).then(()=>{u.finish(n),r.add(t)}).catch(e=>{u.fail(n,e)})});let s=document.createElement("span");s.classList.add("progress-text"),s.setAttribute("download",t.toString());let o=e.querySelector(".card-header");o.classList.add("flex","items-center"),o.appendChild(s),o.appendChild(i)}};e("init",()=>{$(),_(),r.subscribe(e=>{c.forEach(t=>{let r=t.querySelector('button[role="download"'),n=r.getAttribute("state");if("idle"!==n)return;let a=Number(r.getAttribute("id").replace("download-",""));e.includes(a)?r.classList.add("downloaded"):r.classList.remove("downloaded")})})})}}}),System.register("./gallery-CPEntgS8-e9IQWd_w.js",["./utils-YsOI_Z3f-OHnL4je-.js"],function(e,t){"use strict";var r,n,a,i,s,o,l,d,c;return{setters:[e=>{r=e.h,n=e.a,a=e.d,i=e.e,s=e.x,o=e.i,l=e.f,d=e.b,c=e.s}],execute:function(){let t=l(),u=r(document),f=async e=>{e.preventDefault();try{t.starting();let r=await d(u.id);t.processing(0,r.length);let n=0;await c(u,r,e=>{n=e,t.processing(e,r.length)}),t.success(n,r.length)}catch(a){t.fail(),console.error("Failed to download gallery",a)}};e("init",()=>{!function e(){let r=document.querySelector(".level-left > .level-item"),l=r.cloneNode(!0);l.querySelector("a").removeAttribute("href"),l.querySelector(".icon").innerHTML=n,l.querySelector(".button-label").innerHTML="Download",l.addEventListener("click",f),r.after(l),t.subscribe(async e=>{switch(e.kind){case"idle":l.classList.remove("disabled"),l.querySelector(".icon").innerHTML=n,l.querySelector(".button-label").innerHTML="Download";break;case"starting":l.classList.add("disabled"),l.querySelector(".icon").innerHTML=o,l.querySelector(".button-label").innerHTML="Downloading";break;case"processing":l.classList.add("disabled"),l.querySelector(".button-label").innerHTML=`Downloading (${e.progress}/${e.total})`;break;case"failed":l.classList.remove("disabled"),l.querySelector(".icon").innerHTML=s,l.querySelector(".button-label").innerHTML="Download Failed";break;case"success":l.querySelector(".icon").innerHTML=n,l.classList.add("disabled"),l.querySelector(".button-label").innerHTML=`Downloaded (${e.progress}/${e.total})`,a.add(u.id),await i(1500),t.idle()}})}()})}}}),System.register("./utils-YsOI_Z3f-OHnL4je-.js",[],function(e,t){return{execute:function(){var t,r,n,a=Object.defineProperty,i=(e,t,r)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s=(e,t,r)=>(i(e,"symbol"!=typeof t?t+"":t,r),r),o=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},l=(e,t,r)=>(o(e,t,"read from private field"),r?r.call(e):t.get(e)),d=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},c=(e,t,r,n)=>(o(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),u=(e,t,r,n)=>({set _(value){c(e,t,value,r)},get _(){return l(e,t,n)}});let f=(e,t)=>{let r=Array.from(t.querySelectorAll(".view-page-details tr"));return r.find(t=>{var r,n;return null==(n=null==(r=t.querySelector("td"))?void 0:r.textContent)?void 0:n.includes(e)})},h=(e,t)=>{let r=f(e,t);if(r)return Array.from(r.querySelectorAll("a")).map(e=>e.childNodes[0].textContent.trim())},p=e("h",e=>{var t,r,n;let a=Number(e.querySelector('a[href^="/read/"]').getAttribute("href").split("/").at(-1)),i=e.querySelector("h1.title").textContent,s=null==(n=null==(r=null==(t=f("Description",e))?void 0:t.querySelector("td:last-of-type"))?void 0:r.textContent)?void 0:n.trim(),o=h("Artist",e),l=h("Circle",e),d=h("Magazine",e),c=h("Parody",e),u=h("Publisher",e),p=parseInt(f("Pages",e).querySelector("td:last-of-type").textContent.trim()),$=parseInt(f("Favorites",e).querySelector("td:last-of-type").textContent.trim()),_=Array.from(f("Tags",e).querySelectorAll(".tag")).map(e=>e.textContent.trim().split("(")[0].trim());return{id:a,title:i,description:s,artists:o,circles:l,magazines:d,parodies:c,publishers:u,pages:p,favorites:$,tags:_}});e("g",async e=>{let t=await fetch(`/view/${e}`);if(!t.ok)throw Error(`[${t.status}] ${t.statusText} - Failed to get metadata for ${e}`);let r=await t.text(),n=new DOMParser().parseFromString(r,"text/html");return p(n)});var $={},_=function(e,t,r,n,a){var i=new Worker($[t]||($[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return i.onmessage=function(e){var t=e.data,r=t.$e$;if(r){var n=Error(r[0]);n.code=r[1],n.stack=r[2],a(n,null)}else a(null,t)},i.postMessage(r,n),i},m=Uint8Array,g=Uint16Array,v=Int32Array,w=new m([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),b=new m([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),y=new m([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),L=function(e,t){for(var r=new g(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new v(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)a[i]=i-r[n]<<5|n;return{b:r,r:a}},S=L(w,2),x=S.b,E=S.r;x[28]=258,E[258]=28;for(var M=L(b,0).r,k=new g(32768),q=0;q<32768;++q){var T=(43690&q)>>1|(21845&q)<<1;T=(61680&(T=(52428&T)>>2|(13107&T)<<2))>>4|(3855&T)<<4,k[q]=((65280&T)>>8|(255&T)<<8)>>1}for(var z=function(e,t,r){for(var n,a=e.length,i=0,s=new g(t);i<a;++i)e[i]&&++s[e[i]-1];var o=new g(t);for(i=1;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;if(r){n=new g(1<<t);var l=15-t;for(i=0;i<a;++i)if(e[i])for(var d=i<<4|e[i],c=t-e[i],u=o[e[i]-1]++<<c,f=u|(1<<c)-1;u<=f;++u)n[k[u]>>l]=d}else for(i=0,n=new g(a);i<a;++i)e[i]&&(n[i]=k[o[e[i]-1]++]>>15-e[i]);return n},C=new m(288),q=0;q<144;++q)C[q]=8;for(var q=144;q<256;++q)C[q]=9;for(var q=256;q<280;++q)C[q]=7;for(var q=280;q<288;++q)C[q]=8;for(var H=new m(32),q=0;q<32;++q)H[q]=5;var A=z(C,9,0),j=z(H,5,0),D=function(e){return(e+7)/8|0},I=function(e,t,r){return(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length),new m(e.subarray(t,r))},W=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],F=function(e,t,r){var n=Error(t||W[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,F),!r)throw n;return n},O=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},P=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},U=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,i=r.slice();if(!a)return{t:Z,l:0};if(1==a){var s=new m(r[0].s+1);return s[r[0].s]=1,{t:s,l:1}}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var o=r[0],l=r[1],d=0,c=1,u=2;for(r[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=a-1;)o=r[r[d].f<r[u].f?d++:u++],l=r[d!=c&&r[d].f<r[u].f?d++:u++],r[c++]={s:-1,f:o.f+l.f,l:o,r:l};for(var f=i[0].s,n=1;n<a;++n)i[n].s>f&&(f=i[n].s);var h=new g(f+1),p=R(r[c-1],h,0);if(p>t){var n=0,$=0,_=p-t,v=1<<_;for(i.sort(function(e,t){return h[t.s]-h[e.s]||e.f-t.f});n<a;++n){var w=i[n].s;if(h[w]>t)$+=v-(1<<p-h[w]),h[w]=t;else break}for($>>=_;$>0;){var b=i[n].s;h[b]<t?$-=1<<t-h[b]++-1:++n}for(;n>=0&&$;--n){var y=i[n].s;h[y]==t&&(--h[y],++$)}p=t}return{t:new m(h),l:p}},R=function(e,t,r){return -1==e.s?Math.max(R(e.l,t,r+1),R(e.r,t,r+1)):t[e.s]=r},Y=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new g(++t),n=0,a=e[0],i=1,s=function(e){r[n++]=e},o=1;o<=t;++o)if(e[o]==a&&o!=t)++i;else{if(!a&&i>2){for(;i>138;i-=138)s(32754);i>2&&(s(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(s(a),--i;i>6;i-=6)s(8304);i>2&&(s(i-3<<5|8208),i=0)}for(;i--;)s(a);i=1,a=e[o]}return{c:r.subarray(0,n),n:t}},B=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},N=function(e,t,r){var n=r.length,a=D(t+2);e[a]=255&n,e[a+1]=n>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var i=0;i<n;++i)e[a+i+4]=r[i];return(a+4+n)*8},Q=function(e,t,r,n,a,i,s,o,l,d,c){O(t,c++,r),++a[256];for(var u,f,h,p,$=U(a,15),_=$.t,m=$.l,v=U(i,15),L=v.t,S=v.l,x=Y(_),E=x.c,M=x.n,k=Y(L),q=k.c,T=k.n,D=new g(19),I=0;I<E.length;++I)++D[31&E[I]];for(var I=0;I<q.length;++I)++D[31&q[I]];for(var W=U(D,7),F=W.t,R=W.l,Q=19;Q>4&&!F[y[Q-1]];--Q);var V=d+5<<3,Z=B(a,C)+B(i,H)+s,G=B(a,_)+B(i,L)+s+14+3*Q+B(D,F)+2*D[16]+3*D[17]+7*D[18];if(l>=0&&V<=Z&&V<=G)return N(t,c,e.subarray(l,l+d));if(O(t,c,1+(G<Z)),c+=2,G<Z){u=z(_,m,0),f=_,h=z(L,S,0),p=L;var X=z(F,R,0);O(t,c,M-257),O(t,c+5,T-1),O(t,c+10,Q-4),c+=14;for(var I=0;I<Q;++I)O(t,c+3*I,F[y[I]]);c+=3*Q;for(var K=[E,q],J=0;J<2;++J)for(var ee=K[J],I=0;I<ee.length;++I){var et=31&ee[I];O(t,c,X[et]),c+=F[et],et>15&&(O(t,c,ee[I]>>5&127),c+=ee[I]>>12)}}else u=A,f=C,h=j,p=H;for(var I=0;I<o;++I){var er=n[I];if(er>255){var et=er>>18&31;P(t,c,u[et+257]),c+=f[et+257],et>7&&(O(t,c,er>>23&31),c+=w[et]);var en=31&er;P(t,c,h[en]),c+=p[en],en>3&&(P(t,c,er>>5&8191),c+=b[en])}else P(t,c,u[er]),c+=f[er]}return P(t,c,u[256]),c+f[256]},V=new v([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Z=new m(0),G=function(e,t,r,n,a,i){var s=i.z||e.length,o=new m(n+s+5*(1+Math.ceil(s/7e3))+a),l=o.subarray(n,o.length-a),d=i.l,c=7&(i.r||0);if(t){c&&(l[0]=i.r>>3);for(var u=V[t-1],f=u>>13,h=8191&u,p=(1<<r)-1,$=i.p||new g(32768),_=i.h||new g(p+1),y=Math.ceil(r/3),L=2*y,S=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<L)&p},x=new v(25e3),k=new g(288),q=new g(32),T=0,z=0,C=i.i||0,H=0,A=i.w||0,j=0;C+2<s;++C){var W=S(C),F=32767&C,O=_[W];if($[F]=O,_[W]=F,A<=C){var P=s-C;if((T>7e3||H>24576)&&(P>423||!d)){c=Q(e,l,0,x,k,q,z,H,j,C-j,c),H=T=z=0,j=C;for(var U=0;U<286;++U)k[U]=0;for(var U=0;U<30;++U)q[U]=0}var R=2,Y=0,B=h,Z=F-O&32767;if(P>2&&W==S(C-Z))for(var G=Math.min(f,P)-1,X=Math.min(32767,C),K=Math.min(258,P);Z<=X&&--B&&F!=O;){if(e[C+R]==e[C+R-Z]){for(var J=0;J<K&&e[C+J]==e[C+J-Z];++J);if(J>R){if(R=J,Y=Z,J>G)break;for(var ee=Math.min(Z,J-2),et=0,U=0;U<ee;++U){var er=C-Z+U&32767,en=$[er],ea=er-en&32767;ea>et&&(et=ea,O=er)}}}O=$[F=O],Z+=F-O&32767}if(Y){x[H++]=268435456|E[R]<<18|M[Y];var ei=31&E[R],es=31&M[Y];z+=w[ei]+b[es],++k[257+ei],++q[es],A=C+R,++T}else x[H++]=e[C],++k[e[C]]}}for(C=Math.max(C,A);C<s;++C)x[H++]=e[C],++k[e[C]];c=Q(e,l,d,x,k,q,z,H,j,C-j,c),d||(i.r=7&c|l[c/8|0]<<3,c-=7,i.h=_,i.p=$,i.i=C,i.w=A)}else{for(var C=i.w||0;C<s+d;C+=65535){var eo=C+65535;eo>=s&&(l[c/8|0]=d,eo=s),c=N(l,c+1,e.subarray(C,eo))}i.i=s}return I(o,0,n+D(c)+a)},X=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&-306674912)^r>>>1;e[t]=r}return e}(),K=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=X[255&r^t[n]]^r>>>8;e=r},d:function(){return~e}}},J=function(e,t,r,n,a){if(!a&&(a={l:1},t.dictionary)){var i=t.dictionary.subarray(-32768),s=new m(i.length+e.length);s.set(i),s.set(e,i.length),e=s,a.w=i.length}return G(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,a)},ee=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},et=function(e,t,r){for(var n=e(),a=e.toString(),i=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/\s+/g,"").split(","),s=0;s<n.length;++s){var o=n[s],l=i[s];if("function"==typeof o){t+=";"+l+"=";var d=o.toString();if(o.prototype){if(-1!=d.indexOf("[native code]")){var c=d.indexOf(" ",8)+1;t+=d.slice(c,d.indexOf("(",c))}else for(var u in t+=d,o.prototype)t+=";"+l+".prototype."+u+"="+o.prototype[u].toString()}else t+=d}else r[l]=o}return t},er=[],en=function(e){var t=[];for(var r in e)e[r].buffer&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},ea=function(e,t,r,n){if(!er[r]){for(var a="",i={},s=e.length-1,o=0;o<s;++o)a=et(e[o],a,i);er[r]={c:et(e[s],a,i),e:i}}var l=ee({},er[r].e);return _(er[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,l,en(l),n)},ei=function(){return[m,g,v,w,b,y,E,M,A,C,j,H,k,V,Z,z,O,P,U,R,Y,B,N,Q,D,I,G,J,eh,es]},es=function(e){return postMessage(e,[e.buffer])},eo=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},el=function(e,t,r,n,a,i){var s,o=ea(e,n,a,function(e,r){e?(o.terminate(),t.ondata.call(t,e)):Array.isArray(r)?(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1])):i(r)});o.postMessage(r),t.push=function(e,r){t.ondata||F(5),s&&t.ondata(F(4,0,1),null,!!r),o.postMessage([e,s=r],[e.buffer])},t.terminate=function(){o.terminate()}},ed=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8};function ec(e,t){return"function"==typeof e&&(t=e,e={}),this.ondata=t,e}var eu=function(){function e(e,t){if("function"==typeof e&&(t=e,e={}),this.ondata=t,this.o=e||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new m(98304),this.o.dictionary){var r=this.o.dictionary.subarray(-32768);this.b.set(r,32768-r.length),this.s.i=32768-r.length}}return e.prototype.p=function(e,t){this.ondata(J(e,this.o,0,0,this.s),t)},e.prototype.push=function(e,t){this.ondata||F(5),this.s.l&&F(4);var r=e.length+this.s.z;if(r>this.b.length){if(r>2*this.b.length-32768){var n=new m(-32768&r);n.set(this.b.subarray(0,this.s.z)),this.b=n}var a=this.b.length-this.s.z;a&&(this.b.set(e.subarray(0,a),this.s.z),this.s.z=this.b.length,this.p(this.b,!1)),this.b.set(this.b.subarray(-32768)),this.b.set(e.subarray(a),32768),this.s.z=e.length-a+32768,this.s.i=32766,this.s.w=32768}else this.b.set(e,this.s.z),this.s.z+=e.length;this.s.l=1&t,(this.s.z>this.s.w+8191||t)&&(this.p(this.b,t||!1),this.s.w=this.s.i,this.s.i-=2)},e}(),ef=function e(t,r){el([ei,function(){return[eo,eu]}],this,ec.call(this,t,r),function(e){var t=new eu(e.data);onmessage=eo(t)},6)};function eh(e,t){return J(e,t||{},0,0)}var ep="undefined"!=typeof TextEncoder&&new TextEncoder,e$="undefined"!=typeof TextDecoder&&new TextDecoder,e_=0;try{e$.decode(Z,{stream:!0}),e_=1}catch(em){}function eg(e,t){if(t){for(var r=new m(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(ep)return ep.encode(e);for(var a=e.length,i=new m(e.length+(e.length>>1)),s=0,o=function(e){i[s++]=e},n=0;n<a;++n){if(s+5>i.length){var l=new m(s+8+(a-n<<1));l.set(i),i=l}var d=e.charCodeAt(n);d<128||t?o(d):d<2048?(o(192|d>>6),o(128|63&d)):d>55295&&d<57344?(o(240|(d=65536+(1047552&d)|1023&e.charCodeAt(++n))>>18),o(128|d>>12&63),o(128|d>>6&63),o(128|63&d)):(o(224|d>>12),o(128|d>>6&63),o(128|63&d))}return I(i,0,s)}var ev=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;n>65535&&F(9),t+=n+4}return t},ew=function(e,t,r,n,a,i,s,o){var l=n.length,d=r.extra,c=o&&o.length,u=ev(d);ed(e,t,null!=s?33639248:67324752),t+=4,null!=s&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(i<0&&8),e[t++]=a&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var f=new Date(null==r.mtime?Date.now():r.mtime),h=f.getFullYear()-1980;if((h<0||h>119)&&F(10),ed(e,t,h<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>1),t+=4,-1!=i&&(ed(e,t,r.crc),ed(e,t+4,i<0?-i-2:i),ed(e,t+8,r.size)),ed(e,t+12,l),ed(e,t+14,u),t+=16,null!=s&&(ed(e,t,c),ed(e,t+6,r.attrs),ed(e,t+10,s),t+=14),e.set(n,t),t+=l,u)for(var p in d){var $=d[p],_=$.length;ed(e,t,+p),ed(e,t+2,_),e.set($,t+4),t+=4+_}return c&&(e.set(o,t),t+=c),t},e0=function(e,t,r,n,a){ed(e,t,101010256),ed(e,t+8,r),ed(e,t+10,r),ed(e,t+12,n),ed(e,t+16,a)},eb=function(){function e(e){this.filename=e,this.c=K(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){this.ondata||F(5),this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),ey=function(){function e(e,t){var r,n=this;t||(t={}),eb.call(this,e),this.d=new ef(t,function(e,t,r){n.ondata(e,t,r)}),this.compression=8,this.flag=1==(r=t.level)?3:r<6?2:9==r?1:0,this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){eb.prototype.push.call(this,e,t)},e}(),e3=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(this.ondata||F(5),2&this.d)this.ondata(F(4+(1&this.d)*8,0,1),null,!1);else{var r=eg(e.filename),n=r.length,a=e.comment,i=a&&eg(a),s=n!=e.filename.length||i&&a.length!=i.length,o=n+ev(e.extra)+30;n>65535&&this.ondata(F(11,0,1),null,!1);var l=new m(o);ew(l,0,e,r,s,-1);var d=[l],c=function(){for(var e=0,r=d;e<r.length;e++){var n=r[e];t.ondata(null,n,!1)}d=[]},u=this.d;this.d=0;var f=this.u.length,h=ee(e,{f:r,u:s,o:i,t:function(){e.terminate&&e.terminate()},r:function(){if(c(),u){var e=t.u[f+1];e?e.r():t.d=1}u=1}}),p=0;e.ondata=function(r,n,a){if(r)t.ondata(r,n,a),t.terminate();else if(p+=n.length,d.push(n),a){var i=new m(16);ed(i,0,134695760),ed(i,4,e.crc),ed(i,8,p),ed(i,12,e.size),d.push(i),h.c=p,h.b=o+p+16,h.crc=e.crc,h.size=e.size,u&&h.r(),u=1}else u&&c()},this.u.push(h)}},e.prototype.end=function(){var e=this;if(2&this.d){this.ondata(F(4+(1&this.d)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,n=0,a=this.u;n<a.length;n++){var i=a[n];r+=46+i.f.length+ev(i.extra)+(i.o?i.o.length:0)}for(var s=new m(r+22),o=0,l=this.u;o<l.length;o++){var i=l[o];ew(s,e,i,i.f,i.u,-i.c-2,t,i.o),e+=46+i.f.length+ev(i.extra)+(i.o?i.o.length:0),t+=i.b}e0(s,e,this.u.length,r,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}();class e1{constructor(e){s(this,"value"),s(this,"next"),this.value=e}}class e4{constructor(){d(this,t,void 0),d(this,r,void 0),d(this,n,void 0),this.clear()}enqueue(e){let a=new e1(e);l(this,t)?(l(this,r).next=a,c(this,r,a)):(c(this,t,a),c(this,r,a)),u(this,n)._++}dequeue(){let e=l(this,t);if(e)return c(this,t,l(this,t).next),u(this,n)._--,e.value}clear(){c(this,t,void 0),c(this,r,void 0),c(this,n,0)}get size(){return l(this,n)}*[Symbol.iterator](){let e=l(this,t);for(;e;)yield e.value,e=e.next}}t=new WeakMap,r=new WeakMap,n=new WeakMap;let e5={bind:(e,t,r)=>e.bind(r)};var e6={exports:{}};!/*! streamsaver. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */ function(e){var t;t=()=>{let e="object"==typeof window?window:this;e.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let t=null,r=!1,n=e.WebStreamsPolyfill||{},a=e.isSecureContext,i=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint,s=a||"MozAppearance"in document.documentElement.style?"iframe":"navigate",o={createWriteStream:function n(d,c,u){let f={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},h=0,p=null,$=null,_=null;if(Number.isFinite(c)?([u,c]=[c,u],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),f.size=u,f.writableStrategy=c):c&&c.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),f.size=u,f.writableStrategy=c):f=c||{},!i){t||(t=a?l(o.mitm):function t(r){let n=document.createDocumentFragment(),a={frame:e.open(r,"popup","width=200,height=100"),loaded:!1,isIframe:!1,isPopup:!0,remove(){a.frame.close()},addEventListener(...e){n.addEventListener(...e)},dispatchEvent(...e){n.dispatchEvent(...e)},removeEventListener(...e){n.removeEventListener(...e)},postMessage(...e){a.frame.postMessage(...e)}},i=t=>{t.source===a.frame&&(a.loaded=!0,e.removeEventListener("message",i),a.dispatchEvent(new Event("load")))};return e.addEventListener("message",i),a}(o.mitm)),$=new MessageChannel,d=encodeURIComponent(d.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");let m={transferringReadable:r,pathname:f.pathname||Math.random().toString().slice(-6)+"/"+d,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+d}};f.size&&(m.headers["Content-Length"]=f.size);let g=[m,"*",[$.port2]];if(r){let v="iframe"===s?void 0:{transform(e,t){if(!(e instanceof Uint8Array))throw TypeError("Can only write Uint8Arrays");h+=e.length,t.enqueue(e),p&&(location.href=p,p=null)},flush(){p&&(location.href=p)}};_=new o.TransformStream(v,f.writableStrategy,f.readableStrategy);let w=_.readable;$.port1.postMessage({readableStream:w},[w])}$.port1.onmessage=e=>{e.data.download?"navigate"===s?(t.remove(),t=null,h?location.href=e.data.download:p=e.data.download):(t.isPopup&&(t.remove(),t=null,"iframe"===s&&l(o.mitm)),l(e.data.download)):e.data.abort&&(b=[],$.port1.postMessage("abort"),$.port1.onmessage=null,$.port1.close(),$.port2.close(),$=null)},t.loaded?t.postMessage(...g):t.addEventListener("load",()=>{t.postMessage(...g)},{once:!0})}let b=[];return!i&&_&&_.writable||new o.WritableStream({write(e){if(!(e instanceof Uint8Array))throw TypeError("Can only write Uint8Arrays");if(i){b.push(e);return}$.port1.postMessage(e),h+=e.length,p&&(location.href=p,p=null)},close(){if(i){let e=new Blob(b,{type:"application/octet-stream; charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=d,t.click()}else $.port1.postMessage("end")},abort(){b=[],$.port1.postMessage("abort"),$.port1.onmessage=null,$.port1.close(),$.port2.close(),$=null}},f.writableStrategy)},WritableStream:e.WritableStream||n.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function l(e){if(!e)throw Error("meh");let t=document.createElement("iframe");return t.hidden=!0,t.src=e,t.loaded=!1,t.name="iframe",t.isIframe=!0,t.postMessage=(...e)=>t.contentWindow.postMessage(...e),t.addEventListener("load",()=>{t.loaded=!0},{once:!0}),document.body.appendChild(t),t}try{new Response(new ReadableStream),!a||"serviceWorker"in navigator||(i=!0)}catch(d){i=!0}return(e=>{try{e()}catch(t){}})(()=>{let{readable:e}=new TransformStream,t=new MessageChannel;t.port1.postMessage(e,[e]),t.port1.close(),t.port2.close(),r=!0,Object.defineProperty(o,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})}),o},e.exports=t()}(e6);var e2=e6.exports;let eL=[2,3,5,7,11,13,17,19],eS=function e(t){if(!((Number.isInteger(t)||t===Number.POSITIVE_INFINITY)&&t>0))throw TypeError("Expected `concurrency` to be a number from 1 and up");let r=new e4,n=0,a=()=>{n--,r.size>0&&r.dequeue()()},i=async(e,t,r)=>{n++;let i=(async()=>e(...r))();t(i);try{await i}catch{}a()},s=(e,a,s)=>{r.enqueue(e5.bind(i.bind(void 0,e,a,s))),(async()=>{await Promise.resolve(),n<t&&r.size>0&&r.dequeue()()})()},o=(e,...t)=>new Promise(r=>{s(e,r,t)});return Object.defineProperties(o,{activeCount:{get:()=>n},pendingCount:{get:()=>r.size},clearQueue:{value(){r.clear()}}}),o}(4),ex=({title:e,artists:t,magazines:r})=>{let n=[];return t&&(1===t.length?n.push(`[${t[0]}]`):2===t.length?n.push(`[${t[0]} & ${t[1]}]`):t.length>=3&&n.push("[Various]")),n.push(e),(null==r?void 0:r.length)===1&&n.push(`(${r[0]})`),n.join(" ").replace("＊","*").replace("？","?").replace("⁄","/").replace("Ꞓ",":")},eE=e=>{let t=atob(e),r=t.length,n=new Uint8Array(r);for(let a=0;a<r;a++)n[a]=t.charCodeAt(a);return n},eM=e=>{let t=eE(e),r=t.slice(0,64).map(e=>255&e),n=t.slice(64).map(e=>255&e),a=[...Array(256).keys()],i=0;for(let s=0;s<64;s++){i^=r[s];for(let o=0;o<8;o++)i=(1&i)!=0?i>>>1^12:i>>>1}i&=7;let l,d=0;for(let c=0;c<256;c++)d=(d+a[c]+r[c%64])%256,l=a[c],a[c]=a[d],a[d]=l;let u=eL[i],f=0,h=0,p=0,$=0,_="";for(let m=0;m<n.length;m++)h=(p+a[(h+a[f=(f+u)%256])%256])%256,p=(p+f+a[f])%256,l=a[f],a[f]=a[h],a[h]=l,$=a[(h+a[(f+a[($+p)%256])%256])%256],_+=String.fromCharCode(n[m]^$);return _},ek=async(e,t)=>{let r=await fetch(e.image),n=await r.blob(),a=n.type.split("/").at(-1),i=new eb(`${e.url_label}.${a}`);t.add(i),await n.arrayBuffer().then(e=>{i.push(new Uint8Array(e),!0)})};e("s",async(e,t,r)=>new Promise((n,a)=>{let i=e2.createWriteStream(`${ex(e)}.cbz`),s=i.getWriter(),o=new e3;o.ondata=async(e,t,r)=>{e?(s.abort(),a(e)):(s.write(t),r&&s.close())};let l=new ey("metadata.json");o.add(l),l.push(eg(JSON.stringify(e,null,2)),!0);let d=0;Promise.all(t.map(e=>eS(()=>ek(e,o).then(()=>{r(++d)})))).then(()=>{o.end(),n()});let c=()=>s.abort();window.addEventListener("beforeunload",c),s.closed.then(()=>window.removeEventListener("beforeunload",c))})),e("b",async e=>{let t=await fetch(`/read/${e}`);if(!t.ok)throw Error(`[${t.status}] ${t.statusText} - Failed to get images for ${e}`);let r=await t.text(),n=new DOMParser().parseFromString(r,"text/html"),a=Array.from(n.querySelectorAll("script")).find(e=>e.innerHTML.includes("initReader")).innerHTML,i=a.match(/initReader\("([^"]*)"/)[1],s=JSON.parse(eM(i)).filter(e=>"image"===e.type),o="true"===localStorage.getItem("strip_filter");return o?s.map(e=>({...e,image:e.image.replace("?filter=null","")})):s});let eq=e("a",'<svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" viewBox="0 0 24 24"><path fill="currentColor" d="M5 21v-1h14v1zm6.98-3.77L6.366 9.789h3.27V3h4.711v6.788h3.27z"/></svg>'),e8=e("i",'<svg xmlns="http://www.w3.org/2000/svg" class="animate-spin" width="1.3rem" height="1.3rem" viewBox="0 0 24 24"><g fill="currentColor"><path fill-rule="evenodd" d="M12 19a7 7 0 1 0 0-14a7 7 0 0 0 0 14m0 3c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10" clip-rule="evenodd" opacity=".2"/><path d="M2 12C2 6.477 6.477 2 12 2v3a7 7 0 0 0-7 7z"/></g></svg>'),e9=e("x",'<svg xmlns="http://www.w3.org/2000/svg" width="1.3rem" height="1.3rem" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M3.47 3.47a.75.75 0 0 1 1.06 0L8 6.94l3.47-3.47a.75.75 0 1 1 1.06 1.06L9.06 8l3.47 3.47a.75.75 0 1 1-1.06 1.06L8 9.06l-3.47 3.47a.75.75 0 0 1-1.06-1.06L6.94 8L3.47 4.53a.75.75 0 0 1 0-1.06" clip-rule="evenodd"/></svg>');function eT(){}let e7=[];function ez(e,t=eT){let r,n=new Set;function a(t){var a,i;if(a=e,i=t,(a!=a?i==i:a!==i||a&&"object"==typeof a||"function"==typeof a)&&(e=t,r)){let s=!e7.length;for(let o of n)o[1](),e7.push(o,e);if(s){for(let l=0;l<e7.length;l+=2)e7[l][0](e7[l+1]);e7.length=0}}}function i(t){a(t(e))}return{set:a,update:i,subscribe:function s(o,l=eT){let d=[o,l];return n.add(d),1===n.size&&(r=t(a,i)||eT),o(e),()=>{n.delete(d),0===n.size&&r&&(r(),r=null)}}}}e("d",(()=>{let e=JSON.parse(localStorage.getItem("downloads")||"[]"),{set:t,subscribe:r}=ez(e),n=r=>{e.includes(r)||e.push(r),t(e),localStorage.setItem("downloads",JSON.stringify(e))},a=t=>e.includes(t);return{get:()=>e,add:n,includes:a,subscribe:r}})());let eC=e=>Number(e.querySelector("a").getAttribute("href").split("/").at(-1));e("c",e=>{let t=({id:t,title:r})=>{let n=e.find(e=>t===eC(e));if(n){let a=n.querySelector('button[role="download"]');a.setAttribute("state","processing"),a.classList.add("disabled"),a.classList.remove("downloaded","failed"),a.innerHTML=e8,console.log(`Started download for (${t}) '${r}'`)}},r=({id:t},r,n)=>{let a=e.find(e=>t===eC(e));if(a){let i=a.querySelector(`span[download="${t}"]`);i.innerHTML=`${r}/${n}`}},n=({id:t,title:r})=>{let n=e.find(e=>t===eC(e));if(n){let a=n.querySelector('button[role="download"]');a.innerHTML=eq,console.log(`Finished download for (${t}) '${r}'`),i(t)}},a=({id:t,title:r},n)=>{let a=e.find(e=>t===eC(e));if(a){let s=a.querySelector('button[role="download"]');s.classList.add("failed"),s.innerHTML=e9,console.error(`Failed download for (${t}) '${r}'`,n),i(t)}},i=t=>{let r=e.find(e=>t===eC(e)),n=r.querySelector('button[role="download"]');n.setAttribute("state","idle"),n.classList.remove("disabled");let a=r.querySelector(`span[download="${t}"]`);a.innerHTML=""};return{start:t,progress:r,finish:n,fail:a}}),e("f",()=>{let{update:e,subscribe:t}=ez({kind:"idle"}),r=()=>{e(e=>({...e,kind:"idle"}))},n=()=>{e(e=>({...e,kind:"starting"}))},a=(t,r)=>{e(e=>({...e,kind:"processing",progress:t,total:r}))},i=(t,r)=>{e(e=>({...e,kind:"success",progress:t,total:r}))},s=()=>{e(e=>({...e,kind:"failed"}))};return{idle:r,starting:n,processing:a,success:i,fail:s,subscribe:t}}),e("e",e=>new Promise(t=>setTimeout(t,e)))}}}),System.register("./settings-_03oqxPd-XE-OHLWG.js",[],function(e,t){return{execute:function(){let t=({name:e,description:t,value:r})=>{let n=document.createElement("div");n.classList.add("field");let a=document.createElement("input");a.id=e,a.name=e,a.style.marginRight="0.5rem",a.type="checkbox",a.checked=r;let i=document.createElement("label");return i.htmlFor=e,i.innerHTML=t,n.append(a,i),n},r=()=>{let e=document.querySelector(".container"),r=document.createElement("hr"),n=document.createElement("h4");n.classList.add("title","is-4"),n.innerHTML="Script settings";let a=document.createElement("form");a.onsubmit=()=>{let e=new FormData(a),t=Object.fromEntries(e);localStorage.setItem("skip_download",t.skip_download?"true":"false"),localStorage.setItem("strip_filter",t.strip_filter?"true":"false"),location.reload()};let i=localStorage.getItem("skip_download"),s=localStorage.getItem("strip_filter"),o=t({name:"skip_download",description:"Skip downloaded galleries from batch downloads.",value:"true"===i}),l=t({name:"strip_filter",description:"Avoid striping '?filter=null' from the image URL. Enable this if downloads fail or are incomplete.",value:"true"===s});a.append(o,l);let d=document.createElement("div");d.classList.add("filter"),d.innerHTML='<div class="control"><button class="button is-primary">Submit</button></div>',a.append(d);let c=document.createElement("div");c.classList.add("columns");let u=document.createElement("div");u.classList.add("column"),u.append(a),c.append(u),e.append(r),e.append(n),e.append(c)};e("init",()=>{r()})}}}),System.import("./__entry.js","./");
